<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="product.css">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-solid-straight/css/uicons-solid-straight.css'>
    <title>Document</title>
</head>

<body>
    <div class="header">
        <img src="./dior/finaltini-removebg-preview.png" alt="" onclick="clicklogo()">

        <input type="text" placeholder="Search product...">
        <i class="fa-solid fa-user" onclick="clickuser()"></i>
        <div class="dropdown" id="dropdown">
            <div class="div1" onclick="profile()">Profile</div>
            <div class="div1" onclick="changepass()">Change password</div>
            <div class="div1" onclick="logout()">Sign out</div>
        </div>
        <p id="sayhi"></p>
        <i class="fi fi-rr-shopping-bag" onclick="cartpage()">
            <div class="circle-cart">

            </div>
        </i>
        <div id="btLogin" style="font-style:roboto ;" onclick="gologin()">Login</div>
        <div id="btSignup" style="font-style:roboto ;" onclick="gosignup()">Sign Up</div>
      </div>
       <div class="changepass" id="changepass">
        <div>
             <label for="">Fill Email</label>
             <input type="text" placeholder="Email" id="emailcheck">
             <p id="emailnotmatch" style="font-style:italic; color: Red; font-size: 11px; display: none; margin: 2px;">Email not found</p>
        </div>
        <div>
            <label for="">Old Password</label>        
            <input type="text" placeholder="Old password" id="oldpass">
            <p id="passnotmatch" style="font-style:italic; color: Red; font-size: 11px;display: none;margin: 2px">Pass do not exist</p>
        </div>

        <div>
        <label for="">New Password</label>
        <input type="text" placeholder="New password" id="newpass">
        <p id="passincorrect" style="font-style:italic; color: Red; font-size: 11px;display: none;margin: 2px">Pass incorrect</p>
        <p id="matcholdpass" style="font-style:italic; color: Red; font-size: 11px;display: none;margin: 2px"> Do not match with old pass</p>
        <p id="done" style="font-style:italic; color: green; font-size: 15px;display: none;margin: 2px;font-weight: 500;">Done!</p>
        </div>
        
        <div class="btnchangepass">
            <button style="width: 80px; height: 20px;" onclick="update()">Update</button>
        <button style="width: 80px; height: 20px;" onclick="cancel()">Cancel</button>
        </div>
      </div>
    
    <div class="productShow">
        <img src="" alt="">
        <div class="slick">
            <img src="" alt="">
            <img src="" alt="">
            <img src="" alt="">
            <img src="" alt="">

        </div>
    </div>
    <div class="detail">
        <h1 id="title"></h1>
        <p id="des"></p>
        <p id="price"></p>
        <div class="button">
            <button>Add to Cart</button>
            <button onclick="buynow()">Buy Now</button>
        </div>
    </div>
    <script>
        var user=localStorage.getItem("chao")
        let login = localStorage.getItem("boolLogin")
        // Get Id product Choice
       let x= localStorage.getItem("productChoice")
       console.log(x);
       console.log(typeof(x));

       //get product property
       let arr=JSON.parse(localStorage.getItem("data"))
       console.log(arr[x])
       console.log(arr[x].id);
       //add property to html
      /* let a=document.getElementsByClassName("productShow") */
      let a=document.querySelectorAll(".productShow")
      let b= document.getElementsByClassName("slick")
      let c=document.querySelectorAll(".detail")
      console.log(a);
      console.log(b);
      a[0].children[0].src=arr[x].img
      a[0].children[1].children[0].src=arr[x].img2
      a[0].children[1].children[1].src=arr[x].img3
      a[0].children[1].children[2].src=arr[x].img1
      a[0].children[1].children[3].src=arr[x].img
      console.log(a[0].children[1].children);
      //Click small Image
    //   a[0].children[1].children.forEach((tap,index) => {
    //     tap.onclick= function () {
    //         a[0].children[0].src=a[0].children[1].children[index].src
    //     }
    //   });
    let newarr=[]
    newarr=a[0].children[1].children
    console.log(newarr);
    for (let index = 0; index < newarr.length; index++) {
        newarr[index].onclick= function () {
            a[0].children[0].src= newarr[index].src
            // newarr.setAttribute("class", "")
            // newarr[index].setAttribute("class", "shawdow")
            for (let index = 0; index < newarr.length; index++) {
                newarr[index].setAttribute("class", "")
                
            }
            newarr[index].setAttribute("class", "shawdow")
        }
        
    }

    //import detail
    console.log(c);
    document.getElementById("title").textContent=arr[x].title
    document.getElementById("des").innerHTML=arr[x].des
    document.getElementById("price").innerText=`Price: ${new Intl.NumberFormat('de-DE').format(arr[x].price)} $`
   
   
    //add to cart
    let add=document.querySelectorAll(".button")
    console.log(add);
    console.log(add[0].children[0]);
    add[0].children[0].onclick= function () {
        if (login!=="true") {
            alert("You must login first")
        }else{
            let currentArr=[]
        currentArr=JSON.parse(localStorage.getItem(`${user}newcart`))
        console.log(currentArr);
        if (currentArr==null) {
            currentArr=[]
            currentArr.push([arr[x],1])
        }else
        {
            let flag=0;
          for (let index = 0; index < currentArr.length; index++) {
                
                if (currentArr[index][0].id==arr[x].id) {
                    currentArr[index][1] ++
                    flag=1
                }
                
            }
            if (flag==0) {
                currentArr.push([arr[x],1])
            }
        }
        localStorage.setItem(`${user}newcart`,JSON.stringify(currentArr))
        }
    }
      
    
    function clickuser() {
    
    if (login == "true") {
       
        let a = document.getElementById("dropdown")
        console.log(a.style.visibility);
        if (a.style.visibility === "hidden") {
            a.style.visibility = "visible";
        }
        else {
            a.style.visibility = "hidden"
        }
    }

  
}
    //Funtion Change Pass
    function changepass() {
    document.getElementById("changepass").style.visibility="visible"
    document.getElementById("dropdown").style.visibility="hidden"

}
//Update password
function update() {
let flag=0;
let i=0;
let arremail=[];
let arrpass=[];
let re =/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[#$@!%&*?])[A-Za-z\d#$@!%&*?]{8,30}$/
let mail=document.getElementById("emailcheck").value
let pass=document.getElementById("oldpass").value
let newpass=document.getElementById("newpass").value
let user=localStorage.getItem("chao")
let datauser=JSON.parse(localStorage.getItem("cuong"))
// console.log(datauser[1].user);
for (let index = 0; index < datauser.length; index++) {
    if (user==datauser[index].user) {
        i=index
        break;
        
    }
    
}  
// console.log(i);

if (mail!== datauser[i].email) {
    flag=1
    document.getElementById("emailnotmatch").style.display="block"
}
else{
    document.getElementById("emailnotmatch").style.display="none"
}   
if (pass!==datauser[i].pass) {
    flag=1
    document.getElementById("passnotmatch").style.display="block"
}else{
    document.getElementById("passnotmatch").style.display="none"
}
if (!newpass.match(re)) {
    flag=1
    document.getElementById("passincorrect").style.display="block"
}else{
    document.getElementById("passincorrect").style.display="none"
}

 if (pass!=""&&newpass===pass) {
    flag=1
    document.getElementById("matcholdpass").style.display="block"
 }else{
    document.getElementById("matcholdpass").style.display="none"
 }
 console.log(flag);
 if (flag==0) {
    datauser[i].pass=newpass
    localStorage.setItem("cuong",JSON.stringify(datauser))
    document.getElementById("done").style.display="block"
    
    setTimeout(() => {
        document.getElementById("changepass").style.display="none"
      }, 2000)
 }
}
function cancel() {
    document.getElementById("changepass").style.visibility="hidden"
}



    // buy now Button
    function buynow() {
        if (login!=="true") {
            alert("You must login first")
        }else{
            localStorage.setItem("checkoutFromCart","false")
        localStorage.setItem("checkoutfromoutsidecart",x)
        window.location.href="chechout.html"  
        }
        
    }

    // Hide - Visible Icon Cart
if (localStorage.getItem("boolLogin")!="true") {
    document.getElementsByClassName("fi-rr-shopping-bag")[0].style.display="none"

}else{
    document.getElementsByClassName("fi-rr-shopping-bag")[0].style.display="block"
}

// funtion Login
function gologin() {
    window.location.href="login.html"
}
function gosingup() {
    window.location.href="signup.html"
}
if (localStorage.getItem("boolLogin")=="true") {
    document.getElementById("btLogin").style.display="none"
    document.getElementById("btSignup").style.display="none"
}
else{
    document.getElementById("btLogin").style.display="block"
    document.getElementById("btSignup").style.display="block"
}


 // Function Log out
function logout() {
    localStorage.removeItem("chao")
    localStorage.removeItem("boolLogin")
    
    location.reload()
}
// click Profile
function profile() {
    window.location.href="Profile.html"
}

//funtion show UserName and Cart
if (localStorage.getItem("boolLogin")=="true") {
    console.log(localStorage.getItem("boolLogin"));
    // document.getElementById("btLogin").style.display = "none"
    // document.getElementById("btSignup").style.display = "none"
    let user = localStorage.getItem("chao")
    let hi = document.getElementById("sayhi");
    hi.textContent = user
}

function cartpage() {
    window.location.href="cart.html"
}
//click logo
function clicklogo(params) {
    window.location.href="index.html"
}
// Function Signup
function gosignup(params) {
    window.location.href="signup.html"
}
    </script>
    
</body>
 
</html>